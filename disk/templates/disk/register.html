{% load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />  
	<title>泊语湾车行登记表</title>
	  <link rel="stylesheet" href="{% static 'disk/css/bootstrap.min.css' %}">
</head>
 <script type="text/javascript">
    // 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器
    var useragent = navigator.userAgent;
    if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
        // 这里警告框会阻塞当前页面继续加载
        alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
        // 以下代码是用javascript强行关闭当前页面
        var opened = window.open('about:blank', '_self');
        opened.opener = null;
        opened.close();
    }
 </script>
<body>
<!-- 	<canvas id="myCanvas"> 
	Your browser does not support the canvas element.
	</canvas> -->
    <form method="post">
        {% csrf_token %}
        <div class="container-fluid col-lg-12">	
            <br>            
            <div class="form-group text-center">
                <br/>
                <span>
                    <strong>泊语湾出行拼车信息</strong>
                    <br>                    
                </span> 
            </div>
            <hr>
            <div class="form">
                <div class="form-group">
                    <label for="name">昵称 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="name" id="name">
                    <p></p>
                </div>
                <div class="form-group">
                    <label for="roomNo">房号 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="roomNo" id="roomNo">
                    <p></p>
                </div>
                <div class="form-group">
                    <label for="startTime">上班时间 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="startTime" id="startTime" maxlength="5">
                    <p></p>
                </div>
                <div class="form-group">
                    <label for="endTime">下班时间 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="endTime" id="endTime" maxlength="5">
                    <p></p>
                </div>
                <div class="form-group">
                    <label for="roadPath">行车路线 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="roadPath" id="roadPath">
                    <p></p>
                </div>
                <div class="form-group">
                    <label for="availableSeats">可搭载人员数 <span class="required_asterisk">*</span></label>
                    <input type="number" class="form-control required" name="availableSeats" id="availableSeats">
                    <p></p>
                </div>
                  <div class="form-group checkbox">
				    <label>
				      <input type="checkbox" name="isDriver" id="isDriver"> 是否为车主
				    </label>
				  </div>
                <div class="form-group">
                    <label for="mobileNo">联系电话 <span class="required_asterisk">*</span></label>
                    <input type="text" class="form-control required" name="mobileNo" id="mobileNo">
                    <p></p>
                </div>
                <div class="form-group checkbox">
				    <label>
				      <input type="checkbox" name="isPublic" id="isPublic"> 是否公开
				    </label>
				  </div>        
            </div>
            <hr>
            <div class="row">
            	<div class="form-group text-center">
    	        	<button id="btnSubmit" class="btn">提交</button>	
            	</div>
            </div>
        </div>    					      	
    </form>
	<script type="text/javascript" src="{% static 'activity/js/jquery-1.10.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'activity/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript">    
        $(document).ready(function () {				
            var search_str = /^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/;
            $("#emailAddress").change(function () {
                var email_val = $("#emailAddress").val();
                if (!search_str.test(email_val)) {
                	$(this).next('p').text('请填写正确的邮箱地址');
                    $(this).parent().addClass("has-error");
                    $("#btnSubmit").prop("disabled", true);
                    return false;
                } else {
                    $(this).parent().removeClass("has-error");
                    $("#btnSubmit").prop("disabled", false);
                    $(this).next('p').text('');
                }
            });
			
			var mobile_str=/^1\d{10}$/;
			$("#mobileNo").change(function(){
				var mobileNo_val = $(this).val();
				if(!mobile_str.test(mobileNo_val)){
					$(this).next('p').text('请填写正确的手机号码');
                    $(this).parent().addClass("has-error");
                    $("#btnSubmit").prop("disabled", true);
                    return false;
				}else {
                    $(this).parent().removeClass("has-error");
                    $("#btnSubmit").prop("disabled", false);
                    $(this).next('p').text('');
                }				
			});
			
			$("input[id='mobileNo']").keyup(function () {
				var tmptxt = $(this).val();
				$(this).val(tmptxt.replace(/\D|^0/g, ''));	
			}).bind("paste", function () {
				var tmptxt = $(this).val();
				$(this).val(tmptxt.replace(/\D|^0/g, ''));
			}).css("ime-mode", "disabled");

            $(".required").change(function() {
                if ($(this).val() == "") {
                    $(this).parent().addClass("has-error");
                    $("#btnSubmit").prop("disabled", true);
                } else {
                    if ($(this).attr("id") == "emailAddress" || $(this).attr("id") == "mobileNo") {
                      
                    }else{
						$(this).parent().removeClass("has-error");
                        $(this).next('p').text('');
					}
                }
                if ($("div").find(".has-error").length <= 0) {
                    $("#btnSubmit").prop("disabled", false);
                }
            });

            $("input:checkbox").change(function() {
                if ($(this).is(":checked")) {
                    $(".activity").find('p').text('');
                    if ($("div").find(".has-error").length <= 0) {
                        $("#btnSubmit").prop("disabled", false);
                    }
                }else{
                    var cbxFlag = false;
                    $("input:checkbox").each(function(i, item){
                        if($(item).is(":checked")){
                            cbxFlag = true;
                        }
                    })

                    if(!cbxFlag){
                        var labelText = $(".activity").find("label:first").text().replace('*','');
                        $(".activity").find('p').text('请填写'+labelText);
                        $("#btnSubmit").prop("disabled", true);
                    }
                } 
            });

            $("#btnSubmit").click(function () {
                var requiredFlag = false;
                $(".required").each(function (i, item) {
                    if ($(item).val() == "") {
                        $(item).parent().addClass("has-error");
                        var labelText = $(item).prev('label').text().replace('*','');
                        $(item).next('p').text('请填写'+labelText);
                        requiredFlag = true;
                    } else {
                        $(item).parent().removeClass("has-error");
                    }
                });

                var cbxFlag = false;
                $("input:checkbox").each(function(i, item){
                    if($(item).is(":checked")){
                        cbxFlag = true;
                    }
                })
  				
                if(!cbxFlag){
                    var labelText = $(".activity").find("label:first").text().replace('*','');
                    $(".activity").find('p').text('请填写'+labelText);
                    $("#btnSubmit").prop("disabled", true);
                    return false;
                }

  				if(requiredFlag)
  					return false;
            });

            function getCookie(c_name)
            {
                if (document.cookie.length > 0)
                {
                    c_start = document.cookie.indexOf(c_name + "=");
                    if (c_start != -1)
                    {
                        c_start = c_start + c_name.length + 1;
                        c_end = document.cookie.indexOf(";", c_start);
                        if (c_end == -1) c_end = document.cookie.length;
                        return unescape(document.cookie.substring(c_start,c_end));
                    }
                }
                return "";
             }
        });
    </script>
</body>
</html>